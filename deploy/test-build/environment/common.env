# Environment vars common for all microservices
# Important: all lists use semicolon to separate items, and must be quoted to escape ';'
# name of header key used to get authentication:
# possible values: "Authorization" ("X-Userinfo" was disabled)
# Authorization:  JWT token as generated by Keycloak: {"Authorization:", "Bearer fjfk..."}
F7T_AUTH_HEADER_NAME=Authorization
# If AUTH_HEADER_NAME = Authorization, it can also check REALM_RSA_PUBLIC_KEY: RSA key from KeyCloak Realm which signs token.
# REALM_RSA_PUBLIC_KEY="MII....QAB"
# use 1 line without headers ("-----BEGIN PUBLIC KEY-----", "-----END PUBLIC KEY-----")
F7T_REALM_RSA_PUBLIC_KEY=
#kid: "fVc6h439Xv...."
F7T_AUTH_TOKEN_ISSUER=''
# specify Audience established by Keycloak, leave empty to skip verification
F7T_AUTH_TOKEN_AUD=''
# list authorized users, will be checked by cscs_api_common.py: get_username
F7T_AUTH_ALLOWED_USERS=''
# Keycloak scope for clients:
F7T_AUTH_REQUIRED_SCOPE=''
F7T_REALM_RSA_TYPE=RS256
# scopes filtered for this Firecrest, eg  firecrest-tds.cscs.ch, firecrest-production.cscs.ch
F7T_FIRECREST_SERVICE=''
# AUTHENTICATION ROLE for FirecREST Service Accounts
F7T_AUTH_ROLE=''
# DEBUG FLAG
F7T_DEBUG_MODE=True
#-------
# microservices IPs, also defined on each 'env_make' inside containers
F7T_COMPUTE_IP=compute
#TaskPersistence (redis)
F7T_PERSISTENCE_IP=taskpersistence
F7T_STORAGE_IP=storage
#----- ports:
F7T_CERTIFICATOR_PORT=5010
F7T_COMPUTE_PORT=5000
F7T_TASKS_PORT=5003
F7T_STATUS_PORT=5001
F7T_STORAGE_PORT=5002
F7T_UTILITIES_PORT=5004
F7T_RESERVATIONS_PORT=5005
#-------
# microservices urls: used by Kong and between microservices. Must replace $SERVICE_PORT with the port number
F7T_CERTIFICATOR_URL=http://certificator:5010
F7T_TASKS_URL=http://tasks:5003
F7T_COMPUTE_URL=http://compute:5000
F7T_STORAGE_URL=http://storage:5002
F7T_UTILITIES_URL=http://utilities:5004
F7T_STATUS_URL=http://status:5001
F7T_RESERVATIONS_URL=http://reservations:5005
# kong_url: used by microservices when return URL to clients
F7T_KONG_URL=
#-------
# list of systems
#public name for systems, where users except to submit jobs and get files (list with ';')
F7T_SYSTEMS_PUBLIC='system01;system02'
# filesystems mounted in each system
# ; separated for system (position related to SYSTEMS_PUBLIC) and for each filesystem mounted inside each system, separated with ","
# example: let's suppose SYSTEMS_PUBLIC="cluster1;cluster2", cluster1 has "/home" and "/scratch", and cluster2 has mounted "/home":
# FILESYSTEMS = "/home,/scratch;/home"
F7T_FILESYSTEMS="/home;/home"
#internal machines that microservices connect to (in correlation with SYSTEMS_PUBLIC)
F7T_SYSTEMS_INTERNAL_COMPUTE='cluster'
F7T_SYSTEMS_INTERNAL_STORAGE='cluster'
F7T_SYSTEMS_INTERNAL_UTILITIES='cluster'
#-------
# COMPUTE option
# Base filesystem where job submission files will be stored.
# ; separated for system
F7T_COMPUTE_BASE_FS="/home;/home"
# enables the use of a additional plugin in sbatch command for each system
F7T_USE_SPANK_PLUGIN="True;True"
# value of the plugin
F7T_SPANK_PLUGIN_OPTION=--nohome
#-------
# Storage:
# public systems to send a job for internal transfer (xfer), must be defined in SYSTEMS_PUBLIC
F7T_STORAGE_JOBS_MACHINE=system01
# expiration time (in secs) for expiration of URL and files (604800=7 days)
F7T_STORAGE_TEMPURL_EXP_TIME=604800
# staging area max size file supported (in MBytes)
F7T_STORAGE_MAX_FILE_SIZE=512000
# Storage technology used for staging area (swift or s3v2 or s3v4, unset to disable)
F7T_OBJECT_STORAGE='s3v4'
# set if account is needed for SLURM job submission
F7T_USE_SCHED_PROJECT=True
#-------
# STATUS: microservices & systems to pool:
F7T_STATUS_SERVICES='certificator;utilities;compute;tasks;storage;reservations'
F7T_STATUS_SYSTEMS='certificator;utilities;compute;tasks;storage;reservations;'
#-------
# UTILITIES: max size of file for download/upload from filesystem in MB
F7T_UTILITIES_MAX_FILE_SIZE=5
# TIMEOUT in seconds for synchronous tasks
F7T_UTILITIES_TIMEOUT=5
#------
F7T_RESERVATIONS_TIMEOUT=30
#------
# if enabled FirecREST sends a certificate as command, requires a serverside ssh ForceCommand wrapper
F7T_SSH_CERTIFICATE_WRAPPER=True
#------
# KONG internal URLs for services
F7T_KONG_JOBS_URL=
F7T_KONG_STATUS_URL=
F7T_KONG_STORAGE_URL=
F7T_KONG_TASKS_URL=
F7T_KONG_UTILITIES_URL=
# OPA Vars
F7T_OPA_USE=True
F7T_OPA_URL=http://opa:8282
F7T_POLICY_PATH=v1/data/f7t/authz
# SSL vars
#F7T_USE_SSL=False
F7T_SSL_CRT=/ssl/f7t_internal.crt
F7T_SSL_KEY=/ssl/f7t_internal.key
